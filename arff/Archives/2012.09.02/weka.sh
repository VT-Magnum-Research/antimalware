#!/bin/sh
#
# Runs various classifiers on data. This should be in
# a directory with testing and training information
#
# Brandon Amos
# 2012.08.23

WEKA=/usr/share/java/weka/weka.jar
JAVA="java -Xmx1000m -cp $WEKA"

# createModel <classifier> <options>
function createModel {
    CLASSIFIER=$1
    OPTIONS=$2
    MODEL=`echo $CLASSIFIER | sed 's/.*\.//'`

    echo Creating the $MODEL classifier

    cd Models
    $JAVA $CLASSIFIER -t ../Training.arff -d $MODEL.model $OPTIONS &> /dev/null
    cd ..
}

# getResults <classifier>
function getResults {
    CLASSIFIER=$1
    MODEL=`echo $CLASSIFIER | sed 's/.*\.//'`

    echo Testing the $MODEL classifier
    $JAVA $CLASSIFIER \
        -l Models/$MODEL.model \
        -T Testing.arff \
        > TestResults/full-results-$MODEL.txt

    cd Testing
    for file in *.arff; do
        $JAVA $CLASSIFIER \
            -l ../Models/$MODEL.model \
            -T $file \
            > $file.results
    done

    # Combine the results
    cd ../TestResults
    rm -rf $MODEL
    mkdir $MODEL
    cd $MODEL

    mv ../../Testing/*.results .

    for file in *.results; do
        echo $file >> results-$MODEL.txt
        cat $file | grep 'Correctly Classified Instances' >> results-$MODEL.txt
        cat $file | grep 'Incorrectly Classified Instances' >> results-$MODEL.txt
        echo >> results-$MODEL.txt
    done

    cd ../..
}

#########
# Start #
#########

echo Cleaning up and recreating directories
rm -rf Models TestResults
mkdir -p Models TestResults

createModel weka.classifiers.bayes.BayesNet \
    "-D -Q weka.classifiers.bayes.net.search.local.K2 -- -P 1 -S BAYES -E weka.classifiers.bayes.net.estimate.SimpleEstimator -- -A 0.5"
getResults weka.classifiers.bayes.BayesNet


createModel weka.classifiers.bayes.NaiveBayes 
getResults weka.classifiers.bayes.NaiveBayes


createModel weka.classifiers.functions.Logistic "-R 1.0E-8 -M -1"
getResults weka.classifiers.functions.Logistic

createModel weka.classifiers.functions.MultilayerPerceptron "-L 0.3 -M 0.2 -N 500 -V 0 -S 0 -E 20 -H a"
getResults weka.classifiers.functions.MultilayerPerceptron

createModel weka.classifiers.trees.J48 "-C 0.25 -M 2"
getResults weka.classifiers.trees.J48

createModel weka.classifiers.trees.RandomForest "-I 10 -K 0 -S 1 -num-slots 1"
getResults weka.classifiers.trees.RandomForest
