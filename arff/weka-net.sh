#!/bin/sh
#
# Runs various classifiers on an arff file from stdin and writes to stdout.
# This should be in a directory with testing and training information.
#
# Brandon Amos
# 2012.10.21

WEKA=/usr/share/java/weka/weka.jar
JAVA="java -Xmx1000m -cp $WEKA"

# evaluationFactory <evaluation file>
function evaluationFactory {
    evalFile=$1
    # echo Evaluating the classifiers on $evalFile
    
    evalFileName=`basename "$evalFile"`
    rm -f Eval/$evalFileName*
    
    for classifier in "${classifiers[@]}"; do
        MODEL=`echo $classifier | sed 's/.*\.//'`
        $JAVA $classifier \
            -l Models/$MODEL.model \
            -T $evalFile \
            > Eval/$evalFileName-$MODEL.results
    done
    
    cd Eval
    evalResults=$evalFileName-results.txt
    for file in $evalFileName*; do
        echo $file >> $evalResults
        grep -A 1 "Correctly Classified Instances" $file \
            >> $evalResults
        echo >> $evalResults
        rm $file
    done

    cat $evalResults

    cd ..
}


#########
# Start #
#########

declare -a classifiers=(
    weka.classifiers.bayes.BayesNet
    weka.classifiers.bayes.NaiveBayes
    weka.classifiers.functions.Logistic
    weka.classifiers.functions.MultilayerPerceptron
    weka.classifiers.trees.J48
    weka.classifiers.trees.RandomForest
)

arffPayload="`cat`"
uid=$(echo "$arffPayload" | md5sum | awk '{print $1}')
arffFile=Eval/arff/$uid.arff
echo "$arffPayload" > $arffFile

evaluationFactory $arffFile

exit 0
