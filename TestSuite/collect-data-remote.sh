#!/bin/bash
#
# collect-data-remote.sh
# Used to collect data on nodes.
#
# Brandon Amos
# 2012.11.22

source helper.sh
source collect-data-emulator.sh
trap handleInt INT

function startCollection {
    i=1
    
    for (( j=0; j<$EMULATORS; j++ )); do
        let 'PORT=5554+2*j'
        emu_collect Remote $PORT $i | tee logs/emu$i.txt &
        let 'i+=1'
    done
}

function handleInt {
    unpartitionDir Remote 
    pkill collect-data
    pkill weka.sh
}

#########
# Start #
#########

[[ $# != 0 ]] || die 1 "Usage: ./collect-data-remote.sh <Emulators>"

msg Preparing directories
rm -rf ./logs/*
mkdir -p logs

EMULATORS=$1;

partitionDir Remote $EMULATORS
startCollection
wait ${!}
msg "We are done!"

exit 0
